
R version 4.0.4 (2021-02-15) -- "Lost Library Book"
Copyright (C) 2021 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(ouch)
> library(geiger)
Loading required package: ape
> 
> data(geospiza)
> str(geospiza)
List of 4
 $ geospiza.tree:List of 4
  ..$ edge       : num [1:26, 1:2] 15 16 17 18 19 20 21 22 23 24 ...
  ..$ edge.length: num [1:26] 0.2974 0.0492 0.0686 0.134 0.1035 ...
  ..$ Nnode      : int 13
  ..$ tip.label  : chr [1:14] "fuliginosa" "fortis" "magnirostris" "conirostris" ...
  ..- attr(*, "class")= chr "phylo"
 $ geospiza.data: num [1:13, 1:5] 4.4 4.35 4.22 4.26 4.24 ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:13] "magnirostris" "conirostris" "difficilis" "scandens" ...
  .. ..$ : chr [1:5] "wingL" "tarsusL" "culmenL" "beakD" ...
 $ phy          :List of 4
  ..$ edge       : num [1:26, 1:2] 15 16 17 18 19 20 21 22 23 24 ...
  ..$ edge.length: num [1:26] 0.2974 0.0492 0.0686 0.134 0.1035 ...
  ..$ Nnode      : int 13
  ..$ tip.label  : chr [1:14] "fuliginosa" "fortis" "magnirostris" "conirostris" ...
  ..- attr(*, "class")= chr "phylo"
 $ dat          : num [1:13, 1:5] 4.4 4.35 4.22 4.26 4.24 ...
  ..- attr(*, "dimnames")=List of 2
  .. ..$ : chr [1:13] "magnirostris" "conirostris" "difficilis" "scandens" ...
  .. ..$ : chr [1:5] "wingL" "tarsusL" "culmenL" "beakD" ...
> sapply(geospiza,class)
$geospiza.tree
[1] "phylo"

$geospiza.data
[1] "matrix" "array" 

$phy
[1] "phylo"

$dat
[1] "matrix" "array" 

> 
> ### check the correspondence between data and tree tips:
> print(nc <- with(geospiza,name.check(geospiza.tree,geospiza.data)))
$tree_not_data
[1] "olivacea"

$data_not_tree
character(0)

> ### looks like one of the terminal twigs has no data associated
> ### drop that tip:
> tree <- with(geospiza,drop.tip(geospiza.tree,nc$tree_not_data))
> dat <- as.data.frame(geospiza$dat)
> 
> 
> ### make an ouchtree out of the phy-format tree
> ot <- ape2ouch(tree)
> 
> ### merge data with tree info
> otd <- as(ot,"data.frame")
> ### in these data, it so happens that the rownames correspond to node names
> ### we will exploit this correspondence in the 'merge' operation:
> dat$labels <- rownames(dat)
> otd <- merge(otd,dat,by="labels",all=TRUE)
> rownames(otd) <- otd$nodes
> print(otd)
         labels nodes ancestors      times    wingL  tarsusL  culmenL    beakD
1                   1      <NA> 0.00000000       NA       NA       NA       NA
2                   2         3 0.96571409       NA       NA       NA       NA
3                   3         4 0.93999966       NA       NA       NA       NA
4                   4        10 0.85142201       NA       NA       NA       NA
5                   5         6 0.90571375       NA       NA       NA       NA
6                   6         7 0.81142749       NA       NA       NA       NA
7                   7         8 0.68571820       NA       NA       NA       NA
8                   8         9 0.66999811       NA       NA       NA       NA
9                   9        10 0.60914062       NA       NA       NA       NA
10                 10        11 0.43177961       NA       NA       NA       NA
11                 11        12 0.20199544       NA       NA       NA       NA
12                 12         1 0.08441191       NA       NA       NA       NA
22  conirostris    22         7 1.00000000 4.349867 2.984200 2.654400 2.513800
20   difficilis    20         9 1.00000000 4.224067 2.898917 2.277183 2.011100
24       fortis    24         5 1.00000000 4.244008 2.894717 2.407025 2.362658
25   fuliginosa    25         5 1.00000000 4.132957 2.806514 2.094971 1.941157
14        fusca    14        12 1.00000000 3.975393 2.936536 2.051843 1.191264
23 magnirostris    23         6 1.00000000 4.404200 3.038950 2.724667 2.823767
19      pallida    19         4 1.00000000 4.265425 3.089450 2.430250 2.016350
18     parvulus    18         2 1.00000000 4.131600 2.973060 1.974420 1.873540
16       pauper    16         3 1.00000000 4.232500 3.035900 2.187000 2.073400
13 Pinaroloxias    13         1 1.00000000 4.188600 2.980200 2.311100 1.547500
15   Platyspiza    15        11 1.00000000 4.419686 3.270543 2.331471 2.347471
17   psittacula    17         2 1.00000000 4.235020 3.049120 2.259640 2.230040
21     scandens    21         8 1.00000000 4.261222 2.929033 2.621789 2.144700
     gonysW
1        NA
2        NA
3        NA
4        NA
5        NA
6        NA
7        NA
8        NA
9        NA
10       NA
11       NA
12       NA
22 2.360167
20 1.929983
24 2.221867
25 1.845379
14 1.401186
23 2.675983
19 1.949125
18 1.813340
16 1.962100
13 1.630100
15 2.282443
17 2.073940
21 2.036944
> ### this data-frame now contains the data as well as the tree geometry
> 
> ### now remake the ouch tree
> ot <- with(otd,ouchtree(nodes=nodes,ancestors=ancestors,times=times,labels=labels))
> 
> b1 <- brown(tree=ot,data=otd[c("tarsusL","beakD")])
> summary(b1)
$call
brown(data = otd[c("tarsusL", "beakD")], tree = ot)

$sigma.squared
           [,1]       [,2]
[1,] 0.02878091 0.08897504
[2,] 0.08897504 0.43711838

$theta
$theta$tarsusL
[1] 3.020419

$theta$beakD
[1] 1.826695


$loglik
[1] 9.901159

$deviance
[1] -19.80232

$aic
[1] -9.802317

$aic.c
[1] -6.802317

$sic
[1] -3.511834

$dof
[1] 5

> plot(b1)
> 
> ### evaluate an OU model with a single, global selective regime
> otd$regimes <- as.factor("global")
> h1 <- hansen(
+              tree=ot,
+              data=otd[c("tarsusL","beakD")],
+              regimes=otd["regimes"],
+              sqrt.alpha=c(1,0,1),
+              sigma=c(1,0,1),
+              maxit=10000
+              )
> summary(h1)
$call
hansen(data = otd[c("tarsusL", "beakD")], tree = ot, regimes = otd["regimes"], 
    sqrt.alpha = c(1, 0, 1), sigma = c(1, 0, 1), maxit = 10000)

$conv.code
[1] 0

$optimizer.message
NULL

$alpha
         [,1]     [,2]
[1,] 2.267947 1.546466
[2,] 1.546466 4.090125

$sigma.squared
          [,1]     [,2]
[1,] 0.1196484 0.414455
[2,] 0.4144550 1.512855

$optima
$optima$tarsusL
  global 
3.045381 

$optima$beakD
  global 
1.957491 


$loglik
[1] 12.12602

$deviance
[1] -24.25204

$aic
[1] -8.252043

$aic.c
[1] 0.2185449

$sic
[1] 1.812729

$dof
[1] 8

> plot(h1)
> 
> 
